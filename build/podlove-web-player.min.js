/*! ==========================================
 * podlove-web-player 2013-09-24 
 * Podlove <support@podlove.org>
 * https://github.com/podlove/podlove-webplayer.git
 * Licensed under The BSD 2-Clause License
 * http://opensource.org/licenses/BSD-2-Clause
 * =========================================== */
!function(a){"use strict";var b=!1,c=!1,d=[],e=/(?:(\d+):)?(\d+):(\d+)(\.\d+)?([,\-](?:(\d+):)?(\d+):(\d+)(\.\d+)?)?/,f=!1,g=function(a,b){for(var c=a.toString();c.length<b;)c="0"+c;return c},h=a.generateTimecode=function(a,b,c){function d(a){var d,e,f,h,i;return!a||0>=a?b||!a?c?"00:00:00":"00:00":"--":(e=Math.floor(a/60/60),f=Math.floor(a/60)%60,h=Math.floor(a%60)%60,i=Math.floor(1e3*(a%1)),b?(d=g(f,2)+":"+g(h,2),e=g(e,2),e="00"!==e||c?e+":":"",i=i?"."+g(i,3):""):(d=e?g(f,2):f.toString(),d+=":"+g(h,2),e=e?e+":":"",i=i?"."+i:""),e+d+i)}return a[1]>0&&a[1]<9999999&&a[0]<a[1]?d(a[0])+","+d(a[1]):d(a[0])},i=function(a){var b,c=0,d=0;return a&&(b=a.match(e),b&&10===b.length)?(c+=b[1]?60*60*parseInt(b[1],10):0,c+=60*parseInt(b[2],10),c+=parseInt(b[3],10),c+=b[4]?parseFloat(b[4]):0,c=Math.max(c,0),void 0===b[5]?[c,!1]:(d+=b[6]?60*60*parseInt(b[6],10):0,d+=60*parseInt(b[7],10),d+=parseInt(b[8],10),d+=b[9]?parseFloat(b[9]):0,d=Math.max(d,0),d>c?[c,d]:[c,!1])):!1},j=function(){var a;a=i(window.location.href),a!==!1&&(b=a[0],c=a[1])},k=function(a){return a.trim()},l=function(a){window.location.hash=a},m=function(b,c){var d=c.closest(".podlovewebplayer_wrapper").find(".coverimg");c.each(function(){var c,e,f=null,g=a(this),i=g.data("start"),j=g.data("end"),l=g.data("enabled"),m=b.currentTime>i-.3&&b.currentTime<=j;b.buffered.length>0&&(e=b.buffered.end(0)>i),m&&(f=k(g.data("img")),null!==f&&g.hasClass("active")?d.attr("src")!==f&&f.length>5&&d.attr("src",f):d.attr("src")!==d.data("img")&&d.attr("src",d.data("img")),g.addClass("active").siblings().removeClass("active")),!l&&e&&(c="#t="+h([i,j]),a(g).data("enabled",!0).addClass("loaded").find("a[rel=player]").removeClass("disabled"))})},n=function(a){if(!(d.length>1)){var e=a.data.player;b!==!1&&(void 0===e.lastCheck||Math.abs(b-e.lastCheck)>1)&&(e.setCurrentTime(b),e.lastCheck=b,b=!1),c!==!1&&e.currentTime>=c&&(e.pause(),c=!1)}},o=function(a){var b;1===d.length&&(b="t="+h([a.data.player.currentTime]),l(b))},p=function(b){var c=a('<div class="podlovewebplayer_chapterbox showonplay"><table><caption>Podcast Chapters</caption><thead><tr><th scope="col">Chapter Number</th><th scope="col">Start time</th><th scope="col">Title</th><th scope="col">Duration</th></tr></thead><tbody></tbody></table></div>'),d=c.children("table"),e=d.children("tbody");b.chaptersVisible===!0&&c.addClass("active"),d.addClass("podlovewebplayer_chapters"),"false"!==b.chapterlinks&&d.addClass("linked linked_"+b.chapterlinks);var f=b.chapters,g=0;"string"==typeof b.chapters?(f=[],a.each(b.chapters.split("\n"),function(b,c){if(/\S/.test(c)){var d=a.trim(c),e=i(d.substring(0,d.indexOf(" "))),g=a.trim(d.substring(d.indexOf(" ")));f.push({start:e[0],code:g})}})):a.each(f,function(a,b){b.code=b.title,"string"==typeof b.start&&(b.start=i(b.start)[0])}),f=f.sort(function(a,b){return a.start-b.start}),g=Math.max.apply(Math,a.map(f,function(a,b){var c=f[b+1];return c&&(a.end=c.start),a.start}));var j=a('<tr class="chaptertr" data-start="" data-end="" data-img=""><td class="starttime"><span></span></td><td class="chaptername"></td><td class="timecode">\n<span></span>\n</td>\n</tr>');return a.each(f,function(a){var c,d=!f[a+1],i=Math.round(this.end-this.start),k=j.clone();d?0===b.duration?(this.end=9999999999,this.duration="â€¦"):(this.end=b.duration,this.duration=h([Math.round(this.end-this.start)],!1)):this.duration=h([i],!1),a%2&&k.addClass("oddchapter"),k.attr({"data-start":this.start,"data-end":this.end,"data-img":void 0!==this.image?this.image:""}),c=g>=3600,k.find(".starttime > span").text(h([Math.round(this.start)],!0,c)),k.find(".chaptername").html(this.code),k.find(".timecode > span").text(this.duration),k.appendTo(e)}),c},q=function(b,c,e){var g=a(b),i=g,k=!1;1===d.length&&j(),"flash"===b.pluginType&&(i=a("#mep_"+b.id.substring(9)));var p=e.find(".podlovewebplayer_meta"),q=e.find(".summary"),r=e.find(".podlovewebplayer_timecontrol"),s=e.find(".podlovewebplayer_sharebuttons"),t=e.find(".podlovewebplayer_downloadbuttons"),u=e.find(".podlovewebplayer_chapterbox"),v=e.find("table"),w=v.find("tr");q.each(function(){a(this).data("height",a(this).height()+10),a(this).hasClass("active")?a(this).height(a(this).find("div.summarydiv").height()+10+"px"):a(this).height("0px")}),u.each(function(){a(this).data("height",a(this).find(".podlovewebplayer_chapters").height()),a(this).hasClass("active")?a(this).height(a(this).find(".podlovewebplayer_chapters").height()+"px"):a(this).height("0px")}),1===p.length&&(p.find("a.infowindow").click(function(){return q.toggleClass("active"),q.hasClass("active")?q.height(q.find("div.summarydiv").height()+10+"px"):q.height("0px"),!1}),p.find("a.showcontrols").on("click",function(){return r.toggleClass("active"),void 0!==s&&(s.hasClass("active")?s.removeClass("active"):t.hasClass("active")&&t.removeClass("active")),!1}),p.find("a.showsharebuttons").on("click",function(){return s.toggleClass("active"),r.hasClass("active")?r.removeClass("active"):t.hasClass("active")&&t.removeClass("active"),!1}),p.find("a.showdownloadbuttons").on("click",function(){return t.toggleClass("active"),r.hasClass("active")?r.removeClass("active"):s.hasClass("active")&&s.removeClass("active"),!1}),p.find(".bigplay").on("click",function(){if(a(this).hasClass("bigplay")){var c=a(this).parent().find(".bigplay");"number"==typeof b.currentTime&&b.currentTime>0?b.paused?(c.addClass("playing"),b.play()):(c.removeClass("playing"),b.pause()):(c.hasClass("playing")||(c.addClass("playing"),a(this).parent().parent().find(".mejs-time-buffering").show()),"flash"===b.pluginType&&b.pause(),b.play())}return!1}),e.find(".chaptertoggle").unbind("click").click(function(){return e.find(".podlovewebplayer_chapterbox").toggleClass("active"),e.find(".podlovewebplayer_chapterbox").hasClass("active")?e.find(".podlovewebplayer_chapterbox").height(e.find(".podlovewebplayer_chapterbox").data("height")+"px"):e.find(".podlovewebplayer_chapterbox").height("0px"),!1}),e.find(".prevbutton").click(function(){return"number"==typeof b.currentTime&&b.currentTime>0?b.currentTime>u.find(".active").data("start")+10?b.setCurrentTime(u.find(".active").data("start")):b.setCurrentTime(u.find(".active").prev().data("start")):b.play(),!1}),e.find(".nextbutton").click(function(){return"number"==typeof b.currentTime&&b.currentTime>0?b.setCurrentTime(u.find(".active").next().data("start")):b.play(),!1}),e.find(".rewindbutton").click(function(){return"number"==typeof b.currentTime&&b.currentTime>0?b.setCurrentTime(b.currentTime-30):b.play(),!1}),e.find(".forwardbutton").click(function(){return"number"==typeof b.currentTime&&b.currentTime>0?b.setCurrentTime(b.currentTime+30):b.play(),!1}),e.find(".currentbutton").click(function(){return window.prompt("This URL directly points to this episode",a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").attr("href")),!1}),e.find(".tweetbutton").click(function(){return window.open("https://twitter.com/share?text="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").text())+"&url="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").attr("href")),"tweet it","width=550,height=420,resizable=yes"),!1}),e.find(".fbsharebutton").click(function(){return window.open("http://www.facebook.com/share.php?t="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").text())+"&u="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").attr("href")),"share it","width=550,height=340,resizable=yes"),!1}),e.find(".gplusbutton").click(function(){return window.open("https://plus.google.com/share?title="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").text())+"&url="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").attr("href")),"plus it","width=550,height=420,resizable=yes"),!1}),e.find(".adnbutton").click(function(){return window.open("https://alpha.app.net/intent/post?text="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").text())+"%20"+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").attr("href")),"plus it","width=550,height=420,resizable=yes"),!1}),e.find(".mailbutton").click(function(){return window.location="mailto:?subject="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").text())+"&body="+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").text())+"%20%3C"+encodeURI(a(this).closest(".podlovewebplayer_wrapper").find(".episodetitle a").attr("href"))+"%3E",!1}),e.find(".downloadbutton").click(function(){return a(this).parent().find(".fileselect option:selected").each(function(){window.location=a(this).data("dlurl")}),!1}),e.find(".openfilebutton").click(function(){return a(this).parent().find(".fileselect option:selected").each(function(){window.open(a(this).data("url"),"Podlove Popup","width=550,height=420,resizable=yes")}),!1}),e.find(".fileinfobutton").click(function(){return a(this).parent().find(".fileselect option:selected").each(function(){window.prompt("file URL:",a(this).val())}),!1})),v.show().delegate(".chaptertr","click",function(c){if(a(this).closest("table").hasClass("linked_all")||a(this).closest("tr").hasClass("loaded")){c.preventDefault();var e=a(this).closest("tr"),f=e.data("start");1===d.length?l("t="+h([f])):k?b.setCurrentTime(f):g.one("canplay",function(){b.setCurrentTime(f)}),"flash"===b.pluginType&&b.pause(),b.play()}return!1}),g.one("canplay",function(){k=!0,b.duration&&w.find(".timecode code").eq(-1).each(function(){var c=Math.floor(a(this).closest("tr").data("start")),d=Math.floor(b.duration);a(this).text(h([d-c]))}),1===d.length&&(g.bind("play timeupdate",{player:b},n).bind("pause",{player:b},o),j(),a(window).bind("hashchange onpopstate",function(){f||j(),f=!1}))}),g.on("timeupdate",function(){m(b,w)}).on("play playing",function(){b.persistingTimer||(b.persistingTimer=window.setInterval(function(){1===d.length&&(f=!0,window.location.replace("#t="+h([b.currentTime,!1]))),localStorage["podloveWebPlayerTime-"+c.permalink]=b.currentTime},5e3)),v.find(".paused").removeClass("paused"),1===p.length&&p.find(".bigplay").addClass("playing")}).on("pause",function(){window.clearInterval(b.persistingTimer),b.persistingTimer=null,1===p.length&&p.find(".bigplay").removeClass("playing")})};a.fn.podlovewebplayer=function(e){var f={defaultVideoWidth:480,defaultVideoHeight:270,videoWidth:-1,videoHeight:-1,audioWidth:-1,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,features:["playpause","current","progress","duration","tracks","volume","fullscreen"],alwaysShowControls:!1,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,showTimecodeFrameCount:!1,framesPerSecond:25,enableKeyboard:!0,pauseOtherPlayers:!0,duration:!1,plugins:["flash","silverlight"],pluginPath:"./static/",flashName:"flashmediaelement.swf",silverlightName:"silverlightmediaelement.xap"},g=a.extend({},{chapterlinks:"all",width:"100%",duration:!1,chaptersVisible:!1,timecontrolsVisible:!1,sharebuttonsVisible:!1,downloadbuttonsVisible:!1,summaryVisible:!1,hidetimebutton:!1,hidedownloadbutton:!1,hidesharebutton:!1,sharewholeepisode:!1,sources:[]},e);return this.each(function(e,h){var j=!1,k=!1,l=!1,m=0;if(g.width="auto"===g.width.toLowerCase()?"100%":g.width.replace("px",""),"AUDIO"===h.tagName?(void 0!==g.audioWidth&&(g.width=g.audioWidth),f.audioWidth=g.width,a.each(f.features,function(a){"fullscreen"===this&&f.features.splice(a,1)})):"VIDEO"===h.tagName&&(void 0!==g.height&&(f.videoWidth=g.width,f.videoHeight=g.height),void 0!==a(h).attr("width")&&(g.width=a(h).attr("width"))),g.duration&&g.duration!==parseInt(g.duration,10)){var n=i(g.duration);g.duration=n[0]}a.each(f,function(a){void 0!==g[a]&&(f[a]=g[a])}),g.width.toString().trim()===parseInt(g.width,10).toString().trim()&&(g.width=g.width.toString().trim()+"px");var o=h;h=a(h).clone().wrap('<div class="podlovewebplayer_wrapper" style="width: '+g.width+'"></div>')[0];var r,s=a(h).parent();if(d.push(h),a(h).find("[data-pwp]").each(function(){g[a(this).data("pwp")]=a(this).html(),a(this).remove()}),a(h).find("source").each(function(){void 0!==g.sources?g.sources.push(a(this).attr("src")):g.sources[0]=a(this).attr("src")}),void 0!==g.chapters||void 0!==g.title||void 0!==g.subtitle||void 0!==g.summary||void 0!==g.poster||void 0!==a(h).attr("poster")){if(j=!0,s.addClass("podlovewebplayer_"+h.tagName.toLowerCase()),"AUDIO"===h.tagName&&(a.each(f.features,function(a){"playpause"===this&&f.features.splice(a,1)}),s.prepend('<div class="podlovewebplayer_meta"></div>'),s.find(".podlovewebplayer_meta").prepend('<a class="bigplay" title="Play Episode" href="#"></a>'),void 0!==g.poster&&s.find(".podlovewebplayer_meta").append('<div class="coverart"><img class="coverimg" src="'+g.poster+'" data-img="'+g.poster+'" alt=""></div>'),void 0!==a(h).attr("poster")&&s.find(".podlovewebplayer_meta").append('<div class="coverart"><img src="'+a(h).attr("poster")+'" alt=""></div>')),"VIDEO"===h.tagName&&(s.prepend('<div class="podlovewebplayer_top"></div>'),s.append('<div class="podlovewebplayer_meta"></div>')),void 0!==g.title&&(void 0!==g.permalink?s.find(".podlovewebplayer_meta").append('<h3 class="episodetitle"><a href="'+g.permalink+'">'+g.title+"</a></h3>"):s.find(".podlovewebplayer_meta").append('<h3 class="episodetitle">'+g.title+"</h3>")),void 0!==g.subtitle?s.find(".podlovewebplayer_meta").append('<div class="subtitle">'+g.subtitle+"</div>"):(void 0!==g.title&&g.title.length<42&&void 0===g.poster&&s.addClass("podlovewebplayer_smallplayer"),s.find(".podlovewebplayer_meta").append('<div class="subtitle"></div>')),s.find(".podlovewebplayer_meta").append('<div class="togglers"></div>'),s.on("playerresize",function(){s.find(".podlovewebplayer_chapterbox").data("height",s.find(".podlovewebplayer_chapters").height()),s.find(".podlovewebplayer_chapterbox").hasClass("active")&&s.find(".podlovewebplayer_chapterbox").height(s.find(".podlovewebplayer_chapters").height()+"px"),s.find(".summary").data("height",s.find(".summarydiv").height()),s.find(".summary").hasClass("active")&&s.find(".summary").height(s.find(".summarydiv").height()+"px")}),void 0!==g.summary){var t="";g.summaryVisible===!0&&(t=" active"),s.find(".togglers").append('<a href="#" class="infowindow infobuttons pwp-icon-info-circle" title="More information about this"></a>'),s.find(".podlovewebplayer_meta").after('<div class="summary'+t+'"><div class="summarydiv">'+g.summary+"</div></div>")}void 0!==g.chapters&&g.chapters.length>10&&s.find(".togglers").append('<a href="#" class="chaptertoggle infobuttons pwp-icon-list-bullet" title="Show/hide chapters"></a>'),g.hidetimebutton!==!0&&s.find(".togglers").append('<a href="#" class="showcontrols infobuttons pwp-icon-clock" title="Show/hide time navigation controls"></a>')}var u="";g.timecontrolsVisible===!0&&(u=" active");var v="";g.sharebuttonsVisible===!0&&(v=" active");var w="";if(g.downloadbuttonsVisible===!0&&(w=" active"),s.append('<div class="podlovewebplayer_timecontrol podlovewebplayer_controlbox'+u+'"></div>'),void 0!==g.chapters&&g.chapters.length>10&&(s.find(".podlovewebplayer_timecontrol").append('<a href="#" class="prevbutton infobuttons pwp-icon-to-start" title="Jump backward to previous chapter"></a><a href="#" class="nextbutton infobuttons pwp-icon-to-end" title="next chapter"></a>'),s.find(".controlbox").append('<a href="#" class="prevbutton infobuttons pwp-icon-step-backward" title="previous chapter"></a><a href="#" class="nextbutton infobuttons pwp-icon-to-end" title="Jump to next chapter"></a>')),s.find(".podlovewebplayer_timecontrol").append('<a href="#" class="rewindbutton infobuttons pwp-icon-fast-bw" title="Rewind 30 seconds"></a>'),s.find(".podlovewebplayer_timecontrol").append('<a href="#" class="forwardbutton infobuttons pwp-icon-fast-fw" title="Fast forward 30 seconds"></a>'),void 0!==s.closest(".podlovewebplayer_wrapper").find(".episodetitle a").attr("href")&&g.hidesharebutton!==!0&&(s.append('<div class="podlovewebplayer_sharebuttons podlovewebplayer_controlbox'+v+'"></div>'),s.find(".togglers").append('<a href="#" class="showsharebuttons infobuttons pwp-icon-export" title="Show/hide sharing controls"></a>'),s.find(".podlovewebplayer_sharebuttons").append('<a href="#" class="currentbutton infobuttons pwp-icon-link" title="Get URL for this"></a>'),s.find(".podlovewebplayer_sharebuttons").append('<a href="#" target="_blank" class="tweetbutton infobuttons pwp-icon-twitter" title="Share this on Twitter"></a>'),s.find(".podlovewebplayer_sharebuttons").append('<a href="#" target="_blank" class="fbsharebutton infobuttons pwp-icon-facebook" title="Share this on Facebook"></a>'),s.find(".podlovewebplayer_sharebuttons").append('<a href="#" target="_blank" class="gplusbutton infobuttons pwp-icon-gplus" title="Share this on Google+"></a>'),s.find(".podlovewebplayer_sharebuttons").append('<a href="#" target="_blank" class="adnbutton infobuttons pwp-icon-appnet" title="Share this on App.net"></a>'),s.find(".podlovewebplayer_sharebuttons").append('<a href="#" target="_blank" class="mailbutton infobuttons pwp-icon-mail" title="Share this via e-mail"></a>')),(void 0!==g.downloads||void 0!==g.sources)&&g.hidedownloadbutton!==!0){var x,y,z='<select name="downloads" class="fileselect" size="1" onchange="this.value=this.options[this.selectedIndex].value;">';if(s.append('<div class="podlovewebplayer_downloadbuttons podlovewebplayer_controlbox'+w+'"></div>'),s.find(".togglers").append('<a href="#" class="showdownloadbuttons infobuttons pwp-icon-download" title="Show/hide download bar"></a>'),void 0!==g.downloads)for(m=0;m<g.downloads.length;m+=1)x=parseInt(g.downloads[m].size,10)<1048704?Math.round(parseInt(g.downloads[m].size,10)/100)/10+"kB":Math.round(parseInt(g.downloads[m].size,10)/1e3/100)/10+"MB",z+='<option value="'+g.downloads[m].url+'" data-url="'+g.downloads[m].url+'" data-dlurl="'+g.downloads[m].dlurl+'">'+g.downloads[m].name+" (<small>"+x+"</small>)</option>";else for(m=0;m<g.sources.length;m+=1)y=g.sources[m].split("."),y=y[y.length-1],z+='<option value="'+g.sources[m]+'" data-url="'+g.sources[m]+'" data-dlurl="'+g.sources[m]+'">'+y+"</option>";z+="</select>",s.find(".podlovewebplayer_downloadbuttons").append(z),void 0!==g.downloads&&s.find(".podlovewebplayer_downloadbuttons").append('<a href="#" class="downloadbutton infobuttons pwp-icon-download" title="Download"></a> '),s.find(".podlovewebplayer_downloadbuttons").append('<a href="#" class="openfilebutton infobuttons pwp-icon-link-ext" title="Open"></a> '),s.find(".podlovewebplayer_downloadbuttons").append('<a href="#" class="fileinfobutton infobuttons pwp-icon-info-circle" title="Info"></a> ')}if(void 0!==g.chapters&&g.chapters.length>10&&(k=!0,p(g).appendTo(s)),(j||k)&&s.append('<div class="podlovewebplayer_tableend"></div>'),r=i(window.location.href),r!==!1&&1===d.length)void 0!==document.hidden?l=document.hidden:void 0!==document.mozHidden?l=document.mozHidden:void 0!==document.msHidden?l=document.msHidden:void 0!==document.webkitHidden&&(l=document.webkitHidden),l===!0?a(h).attr({preload:"auto"}):a(h).attr({preload:"auto",autoplay:"autoplay"}),b=r[0],c=r[1];else if(g&&g.permalink){var A="podloveWebPlayerTime-"+g.permalink;localStorage[A]&&a(h).one("canplay",function(){this.currentTime=+localStorage[A]})}a(h).on("ended",function(){localStorage.removeItem("podloveWebPlayerTime-"+g.permalink)}),f.success=function(b){q(b,g,s),r!==!1&&1===d.length&&a("html, body").delay(150).animate({scrollTop:a(".podlovewebplayer_wrapper:first").offset().top-25})},a(o).replaceWith(s),a(h).mediaelementplayer(f)})}}(jQuery);