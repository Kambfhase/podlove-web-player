<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>Podlove Web Player Tests</title>

	<link href="libs/mediaelement/build/mediaelementplayer.min.css" rel="stylesheet" media="screen" type="text/css" />
	<link rel="stylesheet" href="libs/pwpfont/css/fontello.css" /><!--[if IE 7]>
	<link rel="stylesheet" href="libs/pwpfont/css/fontello-ie7.css" /><![endif]-->
	<link href="podlove-web-player.css" rel="stylesheet" media="screen" type="text/css" />
	<link href="http://code.jquery.com/qunit/qunit-1.11.0.css" rel="stylesheet" media="screen" type="text/css" />

	<script src="libs/html5shiv.js"></script>
	<script src="http://code.jquery.com/jquery.js"></script>
	<script src="http://code.jquery.com/qunit/qunit-1.11.0.js"></script>
	<script src="libs/mediaelement/build/mediaelement-and-player.min.js"></script>
	<script src="podlove-web-player.js"></script>
</head>

<body>
	<p>
		<audio id="testplayer">
			<source src="samples/podlove-test-track.mp4" type="audio/mp4">
			<source src="samples/podlove-test-track.mp3" type="audio/mp3">
			<source src="samples/podlove-test-track.ogg" type="audio/ogg; codecs=vorbis">
			<source src="samples/podlove-test-track.opus" type="audio/ogg; codecs=opus">
		</audio>

		<script>
			$('#testplayer').podlovewebplayer({
				poster: 'samples/coverimage.png',
				title: 'PWP001 – Lorem ipsum dolor sit amet',
				permalink: 'http://podlove.github.com/podlove-web-player/standalone.html',
				subtitle: 'Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.',
				chapters: '00:00:00.000 Chapter One title'
+"\n"+'00:00:01.000 Chapter Two with <a href="#">hyperlink</a>'
+"\n"+'00:00:01.500 Chapter Three',
				summary: '<p>Summary and even links <a href="https://github.com/gerritvanaaken/podlove-web-player">Podlove Web Player</a>'
+"\n"+'Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Maecenas sed diam eget risus varius blandit sit amet non magna. Maecenas sed diam eget risus varius blandit sit amet non magna.</p>'
+"\n"+'<p>Nullam id dolor id nibh ultricies vehicula ut id elit. Nulla vitae elit libero, a pharetra augue. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Cras mattis consectetur purus sit amet fermentum. Nullam id dolor id nibh ultricies vehicula ut id elit. Praesent commodo cursus magna, vel scelerisque nisl consectetur et.</p>',
				duration: '00:02.500',
				alwaysShowHours: true,
				startVolume: 0.8,
				width: 'auto',
				summaryVisible: false,
				timecontrolsVisible: false,
				sharebuttonsVisible: false,
				chaptersVisible: true	
			});
		</script>
	</p>

	<div id="extendedTests">
		<p>
			<audio>
				<source src="samples/podlove-test-track.mp4" type="audio/mp4">
				<source src="samples/podlove-test-track.mp3" type="audio/mp3">
				<source src="samples/podlove-test-track.ogg" type="audio/ogg; codecs=vorbis">
				<source src="samples/podlove-test-track.opus" type="audio/ogg; codecs=opus">
			</audio>
		</p>
		<p>
			<audio>
				<source src="samples/podlove-test-track.mp3" type="audio/mp3">
				<source src="samples/podlove-test-track.ogg" type="audio/ogg; codecs=vorbis">
				<source src="samples/podlove-test-track.opus" type="audio/ogg; codecs=opus">
			</audio>
		</p>
		<p>
			<audio>
				<source src="samples/podlove-test-track.mp3" type="audio/mp3">
			</audio>
		</p>
		<p>
			<audio>
				<source src="samples/podlove-test-track.mp4" type="audio/mp4">
				<source src="samples/podlove-test-track.opus" type="audio/ogg; codecs=opus">
			</audio>
		</p>
		<p>
			<audio>
				<source src="samples/podlove-test-track.ogg" type="audio/ogg; codecs=vorbis">
			</audio>
		</p>
	</div>
	<div id="qunit"></div>
	<div id="qunit-fixture"></div>
	<script>

test( 'Basics', function() {
	var wrapper = jQuery('#testplayer').closest('.podlovewebplayer_wrapper'),
		player = wrapper.data('player');

	ok( player, 'The player was successfully created')
	ok( wrapper.data('canplay'), 'Der Player müsste spielen können.');
	ok( player.get(0).pluginType !== 'flash' ,'Irgendein Format sollte nativ abzuspielen sein.');
	
	// Test if stuff is visible.
	equal( wrapper.find('.chaptertr').length, 3, 'The basic player has three chapters');
	ok( wrapper.find('table').is(':visible'), 'The chapters a visible');
	ok( wrapper.find('.chaptertoggle').is(':visible'), 'The chapter toggler is visible');

	ok( wrapper.find('.infowindow').is(':visible'), 'The info toggler is visible');
});

module('Basic Functionality');
asyncTest( 'Tests Play/Pause', 2, function(){
	var wrapper = jQuery('#testplayer').closest('.podlovewebplayer_wrapper'),
		player = wrapper.data('player');

	player.on('play', function(){
		ok( true, 'Player plays');
		player.on('pause', function(){
			ok( true, 'Player paused');
			start();
		});
		wrapper.podlovewebplayer('pause');
	});

	wrapper.podlovewebplayer('play');
});
asyncTest( 'Tests Play/Pause', 4, function(){
	var wrapper = jQuery('#testplayer').closest('.podlovewebplayer_wrapper'),
		player = wrapper.data('player'),
		chapterbox = wrapper.find('.podlovewebplayer_chapterbox'),
		height;

	height = chapterbox.height();
	ok( chapterbox.is(':visible'), 'Chapters are initally visible');

	wrapper.find('.chaptertoggle').click();

	// wait for the animation to complete
	setTimeout(function(){
		console.log(chapterbox.height());
		ok( chapterbox.is(':hidden'), 'Chapters get hidden');
		wrapper.find('.chaptertoggle').click();

	}, 1000);
	

	setTimeout(function(){
		ok( chapterbox.is(':visible'), 'Chapters are visible again');
		equal( height, chapterbox.height(), 'The height of the chapterbox stays the same.');
		start();
	}, 2000);
});

	</script>
</body>
</html>